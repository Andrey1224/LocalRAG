

---

````markdown
# üì• PRD: API /ingest ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## tl;dr

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API-—ç–Ω–¥–ø–æ–∏–Ω—Ç `/ingest`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã (PDF, Markdown, HTML, TXT) –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏ –∏–ª–∏ –ø–æ URL. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å—è—Ç—Å—è, –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è, —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ Qdrant. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è idempotent-–∑–∞–≥—Ä—É–∑–∫–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏.

---

## üéØ Goals

### –ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏

- –û–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∑–Ω–∞–Ω–∏–π –∫–æ–º–ø–∞–Ω–∏–∏.
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –≤–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º—É RAG-–ø–æ–∏—Å–∫–∞.
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–∞–±–æ—Ç—É –∞–¥–º–∏–Ω–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### –¶–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- –ë—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –∏ —Å—Ä–∞–∑—É —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –ø–æ–∏—Å–∫–∞.
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω, –æ—à–∏–±–∫–∏ –ø–æ–Ω—è—Ç–Ω—ã, –≤—Å—ë –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è.
- –û–±–Ω–æ–≤–ª—è—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–∑–æ–≤–µ.

### –ù–µ –≤—Ö–æ–¥–∏—Ç –≤ –∑–∞–¥–∞—á–∏

- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö PDF.
- UI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (—Ç–æ–ª—å–∫–æ API).
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π feedback –ø–æ chunk-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ).

---

## üë§ User Stories

- –ö–∞–∫ –∞–¥–º–∏–Ω, —è —Ö–æ—á—É –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ API, —á—Ç–æ–±—ã –æ–Ω —Å—Ç–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞.
- –ö–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —è —Ö–æ—á—É –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –∏ –æ—à–∏–±–∫–∞–º.
- –ö–∞–∫ –ø—Ä–æ–¥—É–∫—Ç, —è —Ö–æ—á—É –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –Ω–µ –±—É–¥–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –∏ —Å—Ç–∞—Ä—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.

---

## üîÅ User Flow

### POST /ingest

**–ó–∞–ø—Ä–æ—Å**:

```json
{
  "paths": [
    "/abs/path/to/file1.pdf",
    "https://example.com/data/file2.md"
  ],
  "delete_missing": false
}
````

**–û–±—Ä–∞–±–æ—Ç–∫–∞**:

1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ API-–∫–ª—é—á—É / JWT).

2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏:

   * –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª (—Å–∫–∞—á–∏–≤–∞–µ–º –ø–æ URL –∏–ª–∏ —á–∏—Ç–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ).
   * –ü–∞—Ä—Å–∏–º –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
   * –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫.
   * –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞–Ω–∫–∏ (‚â§ 1000 —Ç–æ–∫–µ–Ω–æ–≤).
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding + —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Qdrant.
   * –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

3. –ï—Å–ª–∏ `delete_missing = true` ‚Äî —É–¥–∞–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã, –Ω–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `paths[]`.

**–û—Ç–≤–µ—Ç**:

```json
{
  "indexed": 124,
  "skipped": 2,
  "errors": [],
  "doc_id": "abc123"
}
```

---

## üìñ Narrative

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ò–¢-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∑–∏–ª –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏. –û–Ω –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç `/ingest` —Å –ø—É—Ç—ë–º –∫ —Ñ–∞–π–ª—É. –ß–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—ã —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω, —Ä–∞–∑–±–∏—Ç –Ω–∞ —á–∞–Ω–∫–∏ –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞. –í –æ—Ç–≤–µ—Ç–µ –æ–Ω –≤–∏–¥–∏—Ç, —á—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ø–µ—à–Ω–∞, –≤—Å–µ —á–∞–Ω–∫–∏ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã. –ï—Å–ª–∏ –æ–Ω —É–¥–∞–ª–∏–ª —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≤—ã–∑–≤–∞–ª –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å `delete_missing: true`, —Å—Ç–∞—Ä—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª—è–µ—Ç—Å—è ‚Äî —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

---

## ‚úÖ Success Metrics

* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏ –∏ –ø–æ —Å—Å—ã–ª–∫–µ.
* > 95% –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.
* –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø–æ content\_hash).
* –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç ingest.
* –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚â§ 10 —Å–µ–∫ (–¥–æ 50 –ú–ë).
* –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è >90% —á–∞–Ω–∫–æ–≤, –ø—Ä–∏ –ª–∏–º–∏—Ç–µ ‚â§ 2000 —á–∞–Ω–∫–æ–≤/–¥–æ–∫—É–º–µ–Ω—Ç.

---

## üß† Technical Details

* **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã**: PDF (–Ω–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π), .md, .html, .txt
* **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: ‚â§ 50 –ú–ë
* **–ß–∞–Ω–∫**: ‚â§ 1000 —Ç–æ–∫–µ–Ω–æ–≤
* **–Ø–∑—ã–∫**: –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `langdetect`)
* **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: —É–¥–∞–ª–µ–Ω–∏–µ HTML, –ø—Ä–æ–±–µ–ª–æ–≤, –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
* **–ò–Ω–¥–µ–∫—Å**: Qdrant (dense vector index)
* **–î–æ–∫—É–º–µ–Ω—Ç—ã**:

  * –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã: `data/normalized/`
  * –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã: `data/raw/` (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
* **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–∞–Ω–∫–∞**:

```json
{
  "doc_id": "abc123",
  "doc_title": "Policy 2024",
  "source": "file:///docs/policy.pdf",
  "page": 4,
  "section": "2.3 Policies",
  "char_start": 120,
  "char_end": 220,
  "created_at": "2025-08-16T10:42:00Z",
  "updated_at": "2025-08-16T10:42:00Z",
  "language": "en"
}
```

---

## üìé –ü—Ä–∏–º–µ—Ä chunk

```json
{
  "chunk_id": "abc123-004",
  "text": "The company policy states that all budgets...",
  "meta": {
    "page": 4,
    "section": "Policies",
    "source": "file:///docs/policy.pdf#page=4"
  }
}
```

---

## üîê Authentication & Logging

* –¢—Ä–µ–±—É–µ—Ç—Å—è API-–∫–ª—é—á –∏–ª–∏ JWT —Ç–æ–∫–µ–Ω.
* –í—Å–µ –≤—ã–∑–æ–≤—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è: `user_id`, `ip`, `timestamp`, `status`
* –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø—Ä–∞–≤–∞–º–∏ **–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å `/ingest`.

---

## üö® Errors & Validation

| –û—à–∏–±–∫–∞                  | –°–æ–æ–±—â–µ–Ω–∏–µ              | –ö–æ–¥ |
| ----------------------- | ---------------------- | --- |
| –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω          | `FILE_NOT_FOUND`       | 400 |
| URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω          | `URL_FETCH_FAILED`     | 400 |
| PDF –∑–∞—â–∏—â—ë–Ω –ø–∞—Ä–æ–ª–µ–º     | `PDF_PROTECTED`        | 400 |
| –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç | `UNSUPPORTED_FORMAT`   | 415 |
| –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞         | `PARSING_FAILED`       | 422 |
| –§–∞–π–ª –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç    | `FILE_TOO_LARGE`       | 413 |
| –ß–∞–Ω–∫–æ–≤ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ    | `CHUNK_LIMIT_EXCEEDED` | 422 |

–û—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤–µ `errors[]` –≤ –æ—Ç–≤–µ—Ç–µ:

```json
"errors": [
  {
    "path": "/docs/broken.pdf",
    "error": "PDF –∑–∞—â–∏—â—ë–Ω –ø–∞—Ä–æ–ª–µ–º",
    "code": "PDF_PROTECTED"
  }
]
```

---

## üì¶ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ zip-–∞—Ä—Ö–∏–≤–æ–≤ (multi-part ingestion).
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
* –í–µ–±—Ö—É–∫–∏ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏.
* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (UI/–∞–¥–º–∏–Ω–∫–∞).
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–∞–Ω–∫–æ–≤ –ø–æ —è–∑—ã–∫—É/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

---

## üìÜ Milestones & Sequencing

1. **Week 1** ‚Äî –ë–∞–∑–æ–≤—ã–π ingest-—Ñ–ª–æ—É: –∑–∞–≥—Ä—É–∑–∫–∞, –ø–∞—Ä—Å–∏–Ω–≥, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.
2. **Week 2** ‚Äî –ß–∞–Ω–∫–∏ + —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ Qdrant.
3. **Week 3** ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, content\_hash.
4. **Week 4** ‚Äî Delete-missing, idempotency.
5. **Week 5** ‚Äî –¢–µ—Å—Ç—ã, —Å–∏–º—É–ª—è—Ü–∏–∏, –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

```


```

