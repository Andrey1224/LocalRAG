
-

````markdown
# üß™ PRD: API /eval/run ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ RAG-—Å–∏—Å—Ç–µ–º—ã

## tl;dr

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API-—ç–Ω–¥–ø–æ–∏–Ω—Ç `/eval/run`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤ –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–µ–π—Å–æ–≤. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏ RAGAS: faithfulness, answer relevancy, context precision/recall. –û—Ü–µ–Ω–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ JSONL-—Ñ–∞–π–ª—É –∏–ª–∏ —á–µ—Ä–µ–∑ –º–∞—Å—Å–∏–≤ –∫–µ–π—Å–æ–≤ –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –æ—à–∏–±–∫–∏ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏.

---

## üéØ Goals

### –ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏

- –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç–∏–≤–Ω—É—é –º–µ—Ç—Ä–∏–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–∞ –∏ –ø–æ–∏—Å–∫–∞.
- –ë—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –±–µ–∑ —Ä—É—á–Ω–æ–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏.

### –¶–µ–ª–∏ –∫–æ–º–∞–Ω–¥—ã

- –ó–∞–ø—É—Å–∫–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–º —Ç–µ—Å—Ç-–∫–µ–π—Å–∞–º.
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—É—Å–∫–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π (LLM, reranker).

---

## üë§ User Stories

- –ö–∞–∫ ML-–∏–Ω–∂–µ–Ω–µ—Ä, —è —Ö–æ—á—É –ø—Ä–æ–≥–Ω–∞—Ç—å –±–∞—Ç—á —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏.
- –ö–∞–∫ –ø—Ä–æ–¥–∞–∫—Ç, —è —Ö–æ—á—É –ø–æ–Ω–∏–º–∞—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –ö–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —è —Ö–æ—á—É –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–ø—É—Å–∫–∏ –∏ –∏–º–µ—Ç—å trace_id –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

## üîÅ User Flow

### POST /eval/run

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```json
{
  "cases": [
    {
      "question": "–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –ø–æ–ª–∏—Ç–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
      "ground_truth_answer": "–ü–æ–ª–∏—Ç–∏–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å.",
      "ground_truth_chunks": ["chunk_001", "chunk_007"]
    }
  ],
  "llm_model": "llama3.1:8b",
  "reranker": "bge-reranker-v2",
  "eval_type": "ragas"
}
````

* –ï—Å–ª–∏ `cases > 1000` ‚Äî –∑–∞–ø—É—Å–∫ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º.
* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–µ—Ä–µ–¥–∞—Ç—å `path_to_file.jsonl` –≤–º–µ—Å—Ç–æ –º–∞—Å—Å–∏–≤–∞.

#### –ü—Ä–∏–º–µ—Ä –æ–¥–Ω–æ–≥–æ –∫–µ–π—Å–∞:

```json
{
  "question": "–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –ø–æ–ª–∏—Ç–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
  "ground_truth_answer": "–ü–æ–ª–∏—Ç–∏–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å.",
  "ground_truth_chunks": ["chunk_001", "chunk_007"],
  "lang": "ru"
}
```

---

## üß† –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏

### RAGAS-–º–µ—Ç—Ä–∏–∫–∏:

* `faithfulness`: –ù–∞—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ü–∏—Ç–∞—Ç–∞—Ö.
* `answer_relevancy`: –ù–∞—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–µ–Ω –≤–æ–ø—Ä–æ—Å—É.
* `context_precision`: –î–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
* `context_recall`: –°–∫–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ.

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

* `BLEU`, `ROUGE`, `BERTScore` ‚Äî –≤–∫–ª—é—á–∞—é—Ç—Å—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º.
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ HuggingFace Evaluate.

---

## üß± –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

* –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º: –¥–æ 100 –∫–µ–π—Å–æ–≤.
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º: > 1000 –∫–µ–π—Å–æ–≤, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª –∏ –±–∞–∑—É.
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–∞–º–∏: `batch_size = 32`.
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

  * –í–æ–ø—Ä–æ—Å: ‚â§ 500 —Å–∏–º–≤–æ–ª–æ–≤.
  * –û—Ç–≤–µ—Ç: ‚â§ 1000 —Ç–æ–∫–µ–Ω–æ–≤.
  * –Ø–∑—ã–∫: ru / en, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ –∏–ª–∏ —è–≤–Ω–æ.

---

## üìã Response (–æ–¥–∏–Ω –∫–µ–π—Å)

```json
{
  "case_id": 1,
  "faithfulness": 0.83,
  "answer_relevancy": 0.77,
  "context_precision": 0.92,
  "context_recall": 0.88,
  "llm_answer": "–ü–æ–ª–∏—Ç–∏–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å...",
  "citations_used": ["chunk_001", "chunk_005"],
  "flags": ["missing_chunk"],
  "errors": null
}
```

---

## üßë‚Äçüíª –î–æ—Å—Ç—É–ø –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞–ø—É—Å–∫–∞—Ç—å –º–æ–≥—É—Ç: ML-–∏–Ω–∂–µ–Ω–µ—Ä—ã, –ø—Ä–æ–¥–∞–∫—Ç—ã —Å –¥–æ—Å—Ç—É–ø–æ–º.
* –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: API-–∫–ª—é—á / JWT.
* –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è: `user_id`, `timestamp`, `run_id`.

---

## üìÅ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤

* –í—Å–µ –∑–∞–ø—É—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å `run_id`, `trace_id`.
* –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ PostgreSQL.
* –ü–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: `/eval_results/run_{id}.json`.
* –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏:

  * `LLM_FAILED`
  * `TIMEOUT`
  * `INVALID_INPUT`
  * `NO_CITATIONS`
  * `METRIC_ERROR`

---

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

| –°—Ü–µ–Ω–∞—Ä–∏–π              | –ö–æ–¥ –æ—à–∏–±–∫–∏      | –ü–æ–≤–µ–¥–µ–Ω–∏–µ           |
| --------------------- | --------------- | ------------------- |
| LLM –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç       | `LLM_FAILED`    | –ü—Ä–æ–ø—É—Å–∫ –∫–µ–π—Å–∞, –ª–æ–≥  |
| –ù–µ—Ç —Ü–∏—Ç–∞—Ç –≤ –æ—Ç–≤–µ—Ç–µ    | `NO_CITATIONS`  | context\_recall = 0 |
| –ü–ª–æ—Ö–æ–π input —Ñ–æ—Ä–º–∞—Ç   | `INVALID_INPUT` | 400 + –ø–æ—è—Å–Ω–µ–Ω–∏–µ     |
| –ú–µ—Ç—Ä–∏–∫–∞ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ | `METRIC_ERROR`  | –õ–æ–≥ + –∫–µ–π—Å —Ñ–ª–∞–≥–Ω—É—Ç  |

---

## üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–æ–≤

* –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ POST-–∑–∞–ø—Ä–æ—Å.
* –ó–∞–ø—É—Å–∫ –ø–æ webhook –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
* Cron-–∑–∞–ø—É—Å–∫ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é).
* –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏.

---

## üß© –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

* A/B —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–æ–≤ –ø–æ `run_id`.
* UI-–¥—ç—à–±–æ—Ä–¥ (streamlit, gradio) –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Ç–µ—Å—Ç–æ–≤ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∏–º–ø–æ—Ä—Ç .jsonl).
* –§–ª–∞–≥–∏ `manual_review_required`, `regression_detected`.

---

## üìÜ Milestones

1. **Week 1** ‚Äî MVP: –∑–∞–ø—É—Å–∫ RAGAS-–æ—Ü–µ–Ω–∫–∏ –ø–æ JSONL, –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
2. **Week 2** ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—à–∏–±–æ–∫.
3. **Week 3** ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫, language-aware –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
4. **Week 4** ‚Äî Cron-–∑–∞–ø—É—Å–∫–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å webhook –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π.
5. **Week 5** ‚Äî UI-–¥—ç—à–±–æ—Ä–¥, A/B —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, —É–ª—É—á—à–µ–Ω–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è.

---

```

