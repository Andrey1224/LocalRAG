

---

````markdown
# üó£Ô∏è PRD: API /feedback ‚Äî –†—É—á–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## tl;dr

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API-—ç–Ω–¥–ø–æ–∏–Ω—Ç `/feedback`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Ç–≤–µ—Ç—ã, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ LLM. –§–∏–¥–±—ç–∫ –≤–∫–ª—é—á–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (üëç / üëé), –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –ø—Ä–∏—á–∏–Ω—É (–∏–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞), –∏ –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –∞–Ω–æ–Ω–∏–º–Ω—ã–π, —Ç–∞–∫ –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–¥–±—ç–∫. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è, –∞—É–¥–∏—Ç–∞, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ UI-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## üéØ Goals

### –ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏

- –£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –∑–∞ —Å—á—ë—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- –í—ã—è–≤–∏—Ç—å –æ—à–∏–±–∫–∏, –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –∏ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (RLHF, fine-tuning).

### –¶–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- –£–∫–∞–∑–∞—Ç—å, –∫–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç –±—ã–ª –ø–æ–ª–µ–∑–µ–Ω –∏–ª–∏ –Ω–µ—Ç.
- –°–æ–æ–±—â–∏—Ç—å –æ –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ–π –∏–ª–∏ –æ–ø–∞—Å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
- –ü–æ–º–æ—á—å —É–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ –ª—ë–≥–∫–∏–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ü–µ–Ω–∫–∏.

---

## üë§ User Stories

- –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —è —Ö–æ—á—É –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –æ—Ç–≤–µ—Ç –±—ã–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º.
- –ö–∞–∫ ML-–∏–Ω–∂–µ–Ω–µ—Ä, —è —Ö–æ—á—É —Å–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç–∫–∏, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.
- –ö–∞–∫ –ø—Ä–æ–¥–∞–∫—Ç, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —á–∞—â–µ –≤—ã–∑—ã–≤–∞—é—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é.
- –ö–∞–∫ QA-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, —è —Ö–æ—á—É —Ñ–ª–∞–≥–∞—Ç—å –≤—Ä–µ–¥–Ω—ã–µ/–ª–æ–∂–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É.

---

## üîÅ User Flow

### POST /feedback

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```json
{
  "question": "–ö–∞–∫–∏–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–ø–∏—Å–∞–Ω—ã –≤ –ø–æ–ª–∏—Ç–∏–∫–µ?",
  "llm_answer": "–ü–æ–ª–∏—Ç–∏–∫–∞ –≥–ª–∞—Å–∏—Ç, —á—Ç–æ –¥–æ—Å—Ç—É–ø –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.",
  "citations_used": ["chunk_001", "chunk_007"],
  "rating": "down",
  "reason": "–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è",
  "comment": "–û—Ç–≤–µ—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–∫—Ç–∞–º",
  "user_id": "usr_123",
  "session_id": "sess_789",
  "request_id": "req_456"
}
````

* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω.
* `rating`: `up` –∏–ª–∏ `down` (–≤ –±—É–¥—É—â–µ–º —à–∫–∞–ª–∞ 1‚Äì5).
* `reason` –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞.

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
  "status": "ok",
  "feedback_id": "fbk_001",
  "saved_at": "2025-08-16T15:42:00Z"
}
```

---

## üß† –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–∏—á–∏–Ω—ã (`reason`)

* "–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è"
* "–Ω–µ –ø–æ —Ç–µ–º–µ"
* "–Ω–µ–ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç"
* "—É—Å—Ç–∞—Ä–µ–≤—à–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
* "–æ–ø–∞—Å–Ω—ã–π/–≤—Ä–µ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç"

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏–¥–±—ç–∫–∞

```json
{
  "feedback_id": "fbk_001",
  "question": "...",
  "llm_answer": "...",
  "citations_used": [...],
  "rating": "down",
  "reason": "–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è",
  "comment": "...",
  "trace_id": "...",
  "llm_model": "llama3.1:8b",
  "lang": "ru",
  "user_id": "usr_123",
  "session_id": "sess_789",
  "request_id": "req_456",
  "ip": "1.2.3.4",
  "user_agent": "Mozilla/5.0",
  "created_at": "..."
}
```

---

## üîê –î–æ—Å—Ç—É–ø –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

* –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–∂–µ—Ç –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–≤ —Ç.—á. –∞–Ω–æ–Ω–∏–º–Ω—ã–π).
* –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω `user_id`, `session_id`, `request_id` ‚Äî –ª–æ–≥–∏—Ä—É–µ–º.
* –õ–æ–≥–∏—Ä—É–µ–º IP –∏ user-agent –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞.

---

## ‚ö†Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –Ω–µ –±–æ–ª–µ–µ 5 —Ñ–∏–¥–±—ç–∫–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP –≤ –º–∏–Ω—É—Ç—É.
* –í –±—É–¥—É—â–µ–º: –∫–∞–ø—á–∞, rate-limit, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ IP.
* –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è.

---

## üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

–ú–µ—Ç—Ä–∏–∫–∏:

* % –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∏–¥–±—ç–∫–æ–≤ (–ø–æ –º–æ–¥–µ–ª–∏, –¥–∞—Ç–µ)
* –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∂–∞–ª–æ–± (top-5)
* –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (–µ—Å–ª–∏ –≤–≤–µ–¥—ë–º —à–∫–∞–ª—É)
* –û—Ç—á—ë—Ç –ø–æ doc\_id ‚Äî –∫–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —á–∞—â–µ —Ñ–ª–∞–≥—É—é—Ç—Å—è
* –§–∏–¥–±—ç–∫ –ø–æ intent / —Ç–∏–ø—É –æ—Ç–≤–µ—Ç–∞

–§–∏–ª—å—Ç—Ä—ã:

* llm\_model
* –¥–∞—Ç–∞
* —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞ (RAG / non-RAG)
* user\_id (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

---

## üìÅ –•—Ä–∞–Ω–µ–Ω–∏–µ

* –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL / ClickHouse
* –ü–æ–ª–Ω—ã–π JSON —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ CSV
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ UI-–¥—ç—à–±–æ—Ä–¥–∞ (—Ñ–∏–¥–±—ç–∫ –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã)

---

## üß© –§–ª–∞–≥–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã

* `is_hidden`: —Å–∫—Ä—ã—Ç –∏–∑ UI
* `resolved`: –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π
* `needs_review`: —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üß† –ú—É–ª—å—Ç–∏—è–∑—ã—á–∏–µ

* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ
* –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ —á–µ—Ä–µ–∑ langdetect
* –ü–µ—Ä–µ–≤–æ–¥ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤ –±—É–¥—É—â–µ–º

---

## üî≠ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

* `/feedback/chunk`: inline-—Ñ–∏–¥–±—ç–∫ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ü–∏—Ç–∞—Ç—É
* `doc_feedback`: –∞–≥—Ä–µ–≥–∞—Ü–∏—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã
* –í UI ‚Äî ‚Äú23% –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã —ç—Ç–∏–º –æ—Ç–≤–µ—Ç–æ–º‚Äù, ‚Äú12 —Ä–∞–∑ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ ‚Äò–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è‚Äô‚Äù

---

## üìÜ Milestones

1. **Week 1** ‚Äî MVP: —Å–±–æ—Ä —Ñ–∏–¥–±—ç–∫–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
2. **Week 2** ‚Äî UI-–¥—ç—à–±–æ—Ä–¥, –≤—ã–≥—Ä—É–∑–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
3. **Week 3** ‚Äî –ú–µ—Ç–∫–∏ `resolved`, `is_hidden`, —ç–∫—Å–ø–æ—Ä—Ç
4. **Week 4** ‚Äî Inline-—Ñ–∏–¥–±—ç–∫, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ doc\_id
5. **Week 5** ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ loop –æ–±—É—á–µ–Ω–∏—è (RLHF)

---

