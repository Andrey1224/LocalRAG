
---

````markdown
# üê≥ PRD: Docker / Deploy / ENV ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

## tl;dr

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –æ–±—ë—Ä—Ç–∫—É –¥–ª—è —Å–±–æ—Ä–∫–∏, –∑–∞–ø—É—Å–∫–∞ –∏ –¥–µ–ø–ª–æ—è –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø–æ–º–æ—â—å—é Docker. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `.env`, `config.yaml`, multistage Dockerfile, docker-compose. –£–ø–æ—Ä –Ω–∞ dev/prod-—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ, –ª—ë–≥–∫–∏–π —Å—Ç–∞—Ä—Ç, –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ø–ª–æ—è –Ω–∞ HuggingFace, Render, Railway, VPS, –∏–ª–∏ –æ–±–ª–∞—á–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

---

## üéØ Goals

### –ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏

- –ë—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ dev/prod —Å—Ä–µ–¥–µ.
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É –∫–æ–¥–∞ –¥–æ –∑–∞–∫–∞–∑—á–∏–∫–æ–≤, –∫–ª–∏–µ–Ω—Ç–æ–≤, —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–æ–≤.
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤—É –¥–ª—è CI/CD, —Ç–µ—Å—Ç–æ–≤, —Ö–æ—Å—Ç–∏–Ω–≥–∞ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

### –¶–µ–ª–∏ –∫–æ–º–∞–Ω–¥—ã

- –ò–º–µ—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å dev/prod –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- –£–ø–∞–∫–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –≤–∫–ª—é—á–∞—è backend, UI –∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã.

---

## üìÇ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª—ã:

- `.env`: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `.env.example`: —à–∞–±–ª–æ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `config.yaml`: –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–æ–¥–µ–ª–∏, –ª–∏–º–∏—Ç—ã, —á–∞–Ω–∫–∏ –∏ –ø—Ä.)
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `os.environ` + `pydantic.BaseSettings` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –≤ –∫–æ–¥–µ

---

## üê≥ Docker

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ         |
|-----------|--------------------|
| app       | FastAPI backend    |
| ui        | Streamlit frontend |
| qdrant    | –í–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å   |
| ollama    | LLM runtime (–ª–æ–∫–∞–ª—å–Ω–æ) |
| minio     | (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |

### docker-compose.yml

- –û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç dev –∏ prod –≤–µ—Ä—Å–∏–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

### Dockerfile (multi-stage)

- Stage 1: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- Stage 2: –±–∏–ª–¥ –∏ –∑–∞–ø—É—Å–∫
- –£–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç API –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ê–≤—Ç–æ–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ poetry.lock / requirements.txt

### –°–∫—Ä–∏–ø—Ç—ã:

- `start.sh` ‚Äî –∑–∞–ø—É—Å–∫ –≤ dev
- `entrypoint.sh` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ –ø—Ä–æ–¥–µ

---

## üöÄ –î–µ–ø–ª–æ–π

### Target-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:

| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞            | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ                        |
|----------------------|--------------------------------------|
| Hugging Face Spaces  | UI (Streamlit), –±—ã—Å—Ç—Ä–æ–µ MVP          |
| Render / Railway     | Backend (FastAPI)                    |
| Fly.io / VPS         | –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –≤ Docker                 |
| Replicate / Modal    | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ API       |

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- `pyproject.toml` + `poetry.lock` (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)
- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è `requirements.txt` –¥–ª—è Docker

---

## üß™ Health-checks –∏ —Ç–µ—Å—Ç—ã

- `/healthz` endpoint
- `self_check()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–æ–¥–µ–ª–µ–π, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π, –∏–Ω–¥–µ–∫—Å–æ–≤
- –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: –ø—Ä–æ–≤–µ—Ä–∫–∞ latency –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ `/ask`

---

## üîÅ CI/CD

### GitHub Actions:

- On push / pull_request
- –®–∞–≥–∏:
  - `checkout`
  - `lint` (ruff/black)
  - `test` (pytest + coverage)
  - `docker build`
  - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) push –≤ Docker Hub

---

## üß† –û–∫—Ä—É–∂–µ–Ω–∏—è

| ENV   | –ü–æ–≤–µ–¥–µ–Ω–∏–µ                                       |
|--------|------------------------------------------------|
| `dev` | –ª–æ–≥–≥–∏–Ω–≥ –≤ stdout, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞, eval-—Ä–µ–∂–∏–º |
| `prod`| –ª–æ–≥–≥–∏–Ω–≥ –≤ —Ñ–∞–π–ª, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞, –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ |

–ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–∞–∫ `ENV=dev` –≤ `.env`

---

## üßæ –ü—Ä–∏–º–µ—Ä `.env.example`

```env
ENV=dev
API_HOST=0.0.0.0
API_PORT=8000
LLM_MODEL=llama3.1:8b
RERANKER_MODEL=bge-reranker-v2
MAX_TOKENS=400
DEBUG=True
````

---

## üß© config.yaml

```yaml
models:
  llm: llama3.1:8b
  reranker: bge-reranker-v2
limits:
  max_tokens: 400
  context_window: 2500
chunking:
  chunk_size: 1000
  overlap: 100
```

---

## üìÜ Milestones

1. **Week 1** ‚Äî Dockerfile, poetry, .env, –±–∞–∑–æ–≤—ã–π docker-compose
2. **Week 2** ‚Äî –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ UI / API / Qdrant, healthz, self\_check
3. **Week 3** ‚Äî CI/CD —Å GitHub Actions
4. **Week 4** ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ prod-—Ä–µ–∂–∏–º–∞ + —Ö–æ—Å—Ç–∏–Ω–≥ (Render, HuggingFace)

---
